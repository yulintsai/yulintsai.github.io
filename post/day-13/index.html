<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Hugo 0.76.2" />

  <title>[Day 13] Oops！Drone - Cron Jobs &middot; RainForest Notes</title>

  <meta name="description" content="" />

  

<meta itemprop="name" content="[Day 13] Oops！Drone - Cron Jobs">
<meta itemprop="description" content="今天來介紹Drone的排程設定功能及應用 有三個方法可以設定排程
 From Drone Server UI From Drone CLI From Drone API  此篇主要用 From Drone Server UI &amp; From Drone CLI 兩種方式設定來介紹">
<meta itemprop="datePublished" content="2020-09-21T12:15:30+00:00" />
<meta itemprop="dateModified" content="2020-09-21T12:15:30+00:00" />
<meta itemprop="wordCount" content="223">



<meta itemprop="keywords" content="drone,cron job," />


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="[Day 13] Oops！Drone - Cron Jobs"/>
<meta name="twitter:description" content="今天來介紹Drone的排程設定功能及應用 有三個方法可以設定排程
 From Drone Server UI From Drone CLI From Drone API  此篇主要用 From Drone Server UI &amp; From Drone CLI 兩種方式設定來介紹"/>


<meta property="og:title" content="[Day 13] Oops！Drone - Cron Jobs" />
<meta property="og:description" content="今天來介紹Drone的排程設定功能及應用 有三個方法可以設定排程
 From Drone Server UI From Drone CLI From Drone API  此篇主要用 From Drone Server UI &amp; From Drone CLI 兩種方式設定來介紹" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yulintsai.github.io/post/day-13/" />
<meta property="article:published_time" content="2020-09-21T12:15:30+00:00" />
<meta property="article:modified_time" content="2020-09-21T12:15:30+00:00" />



  <link type="text/css"
        rel="stylesheet"
        href="/css/print.css"
        media="print">

  <link type="text/css"
        rel="stylesheet"
        href="/css/poole.css">

  <link type="text/css"
        rel="stylesheet"
        href="/css/hyde.css">

  


  

  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700&display=swap">

  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
        integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk="
        crossorigin="anonymous" />

  <link rel="apple-touch-icon-precomposed"
        sizes="144x144"
        href="/apple-touch-icon-144-precomposed.png">

  <link rel="shortcut icon" href="/favicon.png">

  
  </head>
<body>
  <aside class="sidebar">
  <div class="container">
    <div class="sidebar-about">
      
        
        <div class="author-image">
          <img src="/images/mylogo.jpg" class="img-circle img-headshot center" alt="Profile Picture">
        </div>
        
      

      <h1>RainForest Notes</h1>

      
      <p class="lead">My Notes</p>
      
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li>
          <a href="https://yulintsai.github.io/">Home</a>
        </li>
        <li>
          <a href="/post/">Posts</a>
        </li><li>
          <a href="/about/">About</a>
        </li><li>
          <a href="/tags/">Tags</a>
        </li>
      </ul>
    </nav>

    <section class="social-icons">
      
      <a href="https://github.com/yulintsai" rel="me" title="GitHub" target="_blank">
        <i class="fab fa-github" aria-hidden="true"></i>
      </a>
      
    </section>
  </div>
</aside>


  <main class="content container">
  <div class="post">
  <h1>[Day 13] Oops！Drone - Cron Jobs</h1>

  <div class="post-date">
    <time datetime="2020-09-21T12:15:30Z">Sep 21, 2020</time> &middot; 2 min read
  </div>

  <p>今天來介紹Drone的排程設定功能及應用
有三個方法可以設定排程</p>
<ul>
<li>From Drone Server UI</li>
<li>From Drone CLI</li>
<li>From Drone API</li>
</ul>
<p>此篇主要用 From Drone Server UI &amp; From Drone CLI 兩種方式設定來介紹</p>
<h2 id="1from-drone-server-ui">1.From Drone Server UI</h2>
<p>先到 Drone Server 進入你要設定的repo setting介面，下面有個設定Cron Jobs的功能
<img src="https://ithelp.ithome.com.tw/upload/images/20200919/20115289L8fZ58n3eh.png" alt="https://ithelp.ithome.com.tw/upload/images/20200919/20115289L8fZ58n3eh.png"></p>
<p>為大家示範，我建立了三個分支ithome01, ithome02, ithome03 都設定每小時跑一次
<img src="https://ithelp.ithome.com.tw/upload/images/20200920/20115289a8E5k6D9mh.png" alt="https://ithelp.ithome.com.tw/upload/images/20200920/20115289a8E5k6D9mh.png"></p>
<p><img src="https://ithelp.ithome.com.tw/upload/images/20200920/20115289PJqobG9nPp.png" alt="https://ithelp.ithome.com.tw/upload/images/20200920/20115289PJqobG9nPp.png"></p>
<h4 id="一小時後">一小時後</h4>
<p><img src="https://ithelp.ithome.com.tw/upload/images/20200921/20115289YFr3B9k8XX.png" alt="https://ithelp.ithome.com.tw/upload/images/20200921/20115289YFr3B9k8XX.png"></p>
<h4 id="之後的每小時">之後的每小時</h4>
<h2 id="2from-drone-cli">2.From Drone CLI</h2>
<p>如果想要用drone cli也可以</p>
<h3 id="drone-cli-安裝---文件httpsdocsdroneiocliinstall">Drone CLI 安裝 - <a href="https://docs.drone.io/cli/install/">文件</a></h3>
<h3 id="drone-cli-設定">Drone CLI 設定</h3>
<p><img src="https://ithelp.ithome.com.tw/upload/images/20200919/20115289Iifvrlyx0K.png" alt="https://ithelp.ithome.com.tw/upload/images/20200919/20115289Iifvrlyx0K.png"></p>
<p>進入Drone Server Web UI 右上角 -&gt; 點選 User Settings -&gt; 執行 Example CLI Usage 下方的指令</p>
<p>就完成Drone CLI 的初始化設定囉</p>
<p>列出該專案的所有排程任務</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">drone cron ls my/ithome
</code></pre></div><pre><code>ithome01 
Expr: @hourly
Next: 2020-09-20 00:00:00 +0800 CST

ithome02 
Expr: @hourly
Next: 2020-09-20 00:00:00 +0800 CST

ithome03 
Expr: @hourly
Next: 2020-09-20 00:00:00 +0800 CST
</code></pre><h4 id="自訂排程任務">自訂排程任務</h4>
<blockquote>
<p>Most examples on the internet represent the times using 5 space-separated fields and exclude seconds. Excluding seconds will lead to unexpected behavior.</p>
</blockquote>
<p>建立任務時，Drone 的 cron job跟一般不一樣的地方在於 它多了「秒」的設定，所以務必填寫6個參數5個空格，才不會有非預期的錯誤唷！</p>
<p>CronExp 排程表達式：
<img src="https://ithelp.ithome.com.tw/upload/images/20200921/20115289YyQjfpSLNX.png" alt="https://ithelp.ithome.com.tw/upload/images/20200921/20115289YyQjfpSLNX.png"></p>
<p>圖片來自官網的介紹
<a href="https://docs.drone.io/cron/">https://docs.drone.io/cron/</a></p>
<h4 id="drone-cron-add-example">drone cron add example</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">drone cron add <span style="color:#e6db74">&#34;my/ithome&#34;</span> <span style="color:#e6db74">&#34;hourly 45min 30sec&#34;</span> <span style="color:#e6db74">&#34;30 45 * * * *&#34;</span> --branch ithome01
</code></pre></div><p>列出該專案的所有排程任務</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">drone cron ls my/ithome
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">hourly-45min-30sec
Expr: <span style="color:#ae81ff">30</span> <span style="color:#ae81ff">45</span> * * * *
Next: 2020-09-21 09:45:30 +0800 CST

ithome01
Expr: @hourly
Next: 2020-09-21 10:00:00 +0800 CST

ithome02
Expr: @hourly
Next: 2020-09-21 10:00:00 +0800 CST

ithome03
Expr: @hourly
Next: 2020-09-21 10:00:00 +0800 CST
</code></pre></div><p>可以從列表看到自訂的排程已建立囉～</p>
<h3 id="oops-時間到了怎麼還沒觸發">Oops 時間到了怎麼還沒觸發？</h3>
<blockquote>
<p>Timezones
The current implementation calculates the execution time based on UTC as opposed to local time.</p>
</blockquote>
<p>由於文件上有說明，Cron Jobs 的時區是依照 UTC(Universal Time Coordinated)，所以需要自己在轉換一下時間唷～</p>
<h2 id="應用">應用</h2>
<p>常用來</p>
<ul>
<li>定時跑測試</li>
<li>定時清理資料</li>
<li>定時檢查某些機器</li>
<li>定時執行某個shell script</li>
</ul>

</div>


  </main>

  <footer>
  <div>
    &copy; Yu-Lin Tsai 2020

    

    
  </div>
</footer>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/js/all.min.js"
          integrity="sha256-MAgcygDRahs+F/Nk5Vz387whB4kSK9NXlDN3w58LLq0="
          crossorigin="anonymous"></script>

  

  
</body>
</html>
