<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Hugo 0.76.2" />

  <title>[Day 11] Oops！Drone - 快速上手 &middot; RainForest Notes</title>

  <meta name="description" content="" />

  

<meta itemprop="name" content="[Day 11] Oops！Drone - 快速上手">
<meta itemprop="description" content="想要讓Drone設定的好，就要把基礎先打好！ 認識設定值   kind - 定義對象屬性的類別 目前有">
<meta itemprop="datePublished" content="2020-09-19T00:46:43+00:00" />
<meta itemprop="dateModified" content="2020-09-19T00:46:43+00:00" />
<meta itemprop="wordCount" content="307">



<meta itemprop="keywords" content="drone," />


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="[Day 11] Oops！Drone - 快速上手"/>
<meta name="twitter:description" content="想要讓Drone設定的好，就要把基礎先打好！ 認識設定值   kind - 定義對象屬性的類別 目前有"/>


<meta property="og:title" content="[Day 11] Oops！Drone - 快速上手" />
<meta property="og:description" content="想要讓Drone設定的好，就要把基礎先打好！ 認識設定值   kind - 定義對象屬性的類別 目前有" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yulintsai.github.io/post/day-11/" />
<meta property="article:published_time" content="2020-09-19T00:46:43+00:00" />
<meta property="article:modified_time" content="2020-09-19T00:46:43+00:00" />



  <link type="text/css"
        rel="stylesheet"
        href="/css/print.css"
        media="print">

  <link type="text/css"
        rel="stylesheet"
        href="/css/poole.css">

  <link type="text/css"
        rel="stylesheet"
        href="/css/hyde.css">

  


  

  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700&display=swap">

  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
        integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk="
        crossorigin="anonymous" />

  <link rel="apple-touch-icon-precomposed"
        sizes="144x144"
        href="/apple-touch-icon-144-precomposed.png">

  <link rel="shortcut icon" href="/favicon.png">

  
  </head>
<body>
  <aside class="sidebar">
  <div class="container">
    <div class="sidebar-about">
      
        
        <div class="author-image">
          <img src="/images/mylogo.jpg" class="img-circle img-headshot center" alt="Profile Picture">
        </div>
        
      

      <h1>RainForest Notes</h1>

      
      <p class="lead">My Notes</p>
      
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li>
          <a href="https://yulintsai.github.io/">Home</a>
        </li>
        
      </ul>
    </nav>

    <section class="social-icons">
      
    </section>
  </div>
</aside>


  <main class="content container">
  <div class="post">
  <h1>[Day 11] Oops！Drone - 快速上手</h1>

  <div class="post-date">
    <time datetime="2020-09-19T00:46:43Z">Sep 19, 2020</time> &middot; 2 min read
  </div>

  <h2 id="想要讓drone設定的好就要把基礎先打好">想要讓Drone設定的好，就要把基礎先打好！</h2>
<h1 id="認識設定值">認識設定值</h1>
<ul>
<li>
<p>kind - 定義對象屬性的類別
目前有</p>
<ul>
<li>Pipeline -&gt; 流程定義 (最常用的)</li>
<li>Secret -&gt; 儲存敏感資訊，可以在drone server上操作</li>
<li>Signature -&gt; 是透過drone cli產生，主要是防止被串改使用</li>
</ul>
</li>
<li>
<p>type - 此屬性定義 <a href="https://docs.drone.io/pipeline/overview/">Pipeline的類型</a>
目前下列有六種</p>
<ul>
<li>docker</li>
<li>kubernetes</li>
<li>exec</li>
<li>ssh</li>
<li>digitalocean</li>
<li>macstadium</li>
</ul>
</li>
<li>
<p>name - 此屬性定義 Pipeline的名稱</p>
</li>
<li>
<p>steps - 定義了一連串執行 Pipeline的步驟。 如果 Pipeline中的任何步驟失敗，將會立即退出</p>
<ul>
<li>name - 定義 Pipeline 步驟的名稱</li>
<li>image - 定義執行腳本的Docker映像檔案</li>
<li>commands - 定義了在 Docker容器內作為容器入口點執行的 Shell命令列表。 如果有任何命令返回非零退出，則 Pipeline步驟會失敗。</li>
</ul>
</li>
</ul>
<p>看完上述描述可以看下方的 exmaple yaml檔來比對</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">pipeline</span>
<span style="color:#f92672">type</span>: <span style="color:#ae81ff">docker</span>
<span style="color:#f92672">name</span>: <span style="color:#ae81ff">backend</span>

<span style="color:#f92672">steps</span>:
- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">golang test</span>
  <span style="color:#f92672">image</span>: <span style="color:#ae81ff">golang:1.14</span>
  <span style="color:#f92672">commands</span>:
    - <span style="color:#ae81ff">go test</span>
</code></pre></div><h2 id="基礎練習">基礎練習</h2>
<h3 id="看完上述的簡介是不是對-drone還有些陌生呢">看完上述的簡介，是不是對 Drone還有些陌生呢？</h3>
<h3 id="事不宜遲今天要來讓大家練習寫-drone設定yaml加深印象">事不宜遲，今天要來讓大家練習寫 Drone設定yaml！加深印象！</h3>
<p><strong>以下是我列出的練習題目及示範給各位</strong></p>
<h3 id="1-echo-hello-drone">1. echo hello drone</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">pipeline</span>
<span style="color:#f92672">type</span>: <span style="color:#ae81ff">docker</span>
<span style="color:#f92672">name</span>: <span style="color:#ae81ff">backend</span>

<span style="color:#f92672">steps</span>:
- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">practice</span>
  <span style="color:#f92672">image</span>: <span style="color:#ae81ff">golang</span>
  <span style="color:#f92672">commands</span>:
    - <span style="color:#ae81ff">echo hello drone</span>
</code></pre></div><h3 id="2-只讓test分支跑golang-test">2. 只讓test分支，跑golang test</h3>
<pre><code>kind: pipeline
type: docker
name: backend

steps:
- name: practice
  image: golang
  when:
    branch: 
    - test
  commands:
    - go test
</code></pre><h3 id="3-只在-masertest分支跑-golang-test">3. 只在 maser,test分支，跑 golang test</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">pipeline</span>
<span style="color:#f92672">type</span>: <span style="color:#ae81ff">docker</span>
<span style="color:#f92672">name</span>: <span style="color:#ae81ff">backend</span>

<span style="color:#f92672">steps</span>:
- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">practice</span>
  <span style="color:#f92672">image</span>: <span style="color:#ae81ff">golang</span>
  <span style="color:#f92672">when</span>:
    <span style="color:#f92672">branch</span>: 
    - <span style="color:#ae81ff">test</span>
    - <span style="color:#ae81ff">master</span>
  <span style="color:#f92672">commands</span>:
    - <span style="color:#ae81ff">go test</span>
</code></pre></div><h3 id="4-golang-repo---docker-build-image">4. golang repo - docker build image</h3>
<p>先建立一個 go.dockerfile 檔案</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dockerfile" data-lang="dockerfile"><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> golang</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> /ithome</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ADD</span> . /ithome<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> cd /ithome <span style="color:#f92672">&amp;&amp;</span> go build<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">CMD</span> [<span style="color:#e6db74">&#34;./ithome&#34;</span>]<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>.drone.yml</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">pipeline</span>
<span style="color:#f92672">type</span>: <span style="color:#ae81ff">docker</span>
<span style="color:#f92672">name</span>: <span style="color:#ae81ff">backend</span>

<span style="color:#f92672">steps</span>:
- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">test</span>
  <span style="color:#f92672">image</span>: <span style="color:#ae81ff">docker:dind</span>
  <span style="color:#f92672">volumes</span>:
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">dockersock</span>
    <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/var/run/docker.sock</span>
  <span style="color:#f92672">commands</span>:
  - <span style="color:#ae81ff">docker build --no-cache --pull --force-rm -t rain/ithome:latest -f go.dockerfile .</span>

<span style="color:#f92672">volumes</span>:
- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">dockersock</span>
  <span style="color:#f92672">host</span>:
    <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/var/run/docker.sock</span>
</code></pre></div><h3 id="5-只在-master分支跑-golang-test--build成image">5. 只在 master分支跑 golang test + build成image</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">pipeline</span>
<span style="color:#f92672">type</span>: <span style="color:#ae81ff">docker</span>
<span style="color:#f92672">name</span>: <span style="color:#ae81ff">backend</span>

<span style="color:#f92672">steps</span>:
- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">practice</span>
  <span style="color:#f92672">when</span>:
    <span style="color:#f92672">branch</span>: 
    - <span style="color:#ae81ff">master</span>
  <span style="color:#f92672">image</span>: <span style="color:#ae81ff">docker:dind</span>
  <span style="color:#f92672">volumes</span>:
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">dockersock</span>
    <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/var/run/docker.sock</span>
  <span style="color:#f92672">commands</span>:
  - <span style="color:#ae81ff">docker build --no-cache --pull --force-rm -t rain/ithome:latest -f go.dockerfile .</span>

<span style="color:#f92672">volumes</span>:
- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">dockersock</span>
  <span style="color:#f92672">host</span>:
    <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/var/run/docker.sock</span>
</code></pre></div><h3 id="6-當觸發-tag事件時跑-golang-test--build-成-image">6. 當觸發 tag事件時，跑 golang test + build 成 image</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">pipeline</span>
<span style="color:#f92672">type</span>: <span style="color:#ae81ff">docker</span>
<span style="color:#f92672">name</span>: <span style="color:#ae81ff">backend</span>

<span style="color:#f92672">steps</span>:
- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">practice</span>
  <span style="color:#f92672">image</span>: <span style="color:#ae81ff">docker:dind</span>
  <span style="color:#f92672">volumes</span>:
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">dockersock</span>
    <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/var/run/docker.sock</span>
  <span style="color:#f92672">commands</span>:
  - <span style="color:#ae81ff">docker build --no-cache --pull --force-rm -t rain/ithome:latest -f go.dockerfile .</span>

<span style="color:#f92672">trigger</span>:
  <span style="color:#f92672">event</span>:
  - <span style="color:#ae81ff">tag</span>

<span style="color:#f92672">volumes</span>:
- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">dockersock</span>
  <span style="color:#f92672">host</span>:
    <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/var/run/docker.sock</span>
</code></pre></div><h3 id="今天練習到這邊各位讀者們有沒有一點fu了呀imagesemoticonemoticon69gifimagesemoticonemoticon69gif">今天練習到這邊，各位讀者們有沒有一點fu了呀？<img src="/images/emoticon/emoticon69.gif" alt="/images/emoticon/emoticon69.gif"></h3>
<p>明天會帶各位進入進階的練習唷～敬請期待！</p>

</div>


  </main>

  <footer>
  <div>
    &copy;  2020

    

    
  </div>
</footer>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/js/all.min.js"
          integrity="sha256-MAgcygDRahs+F/Nk5Vz387whB4kSK9NXlDN3w58LLq0="
          crossorigin="anonymous"></script>

  

  
</body>
</html>
